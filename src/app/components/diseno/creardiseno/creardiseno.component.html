<app-menu></app-menu>
<div class="diseño-container">

	<h1 class="titulo">Crea tu diseño</h1>
	<p class="subtitulo">Transforma tus ideas en prendas únicas con nuestros servicios exclusivos</p>

	<div class="container" style="display: flex; gap: 2rem; padding: 2rem">
		<form [formGroup]="form" (ngSubmit)="aceptar()" style="flex: 1">
			<mat-slide-toggle formControlName="tipoIA">
				¿Generar con IA?
			</mat-slide-toggle>

			<h2 *ngIf="form.get('tipoIA')?.value">Personaliza con IA</h2>
      		<p class="descripcion" *ngIf="form.get('tipoIA')?.value">Utiliza nuestra inteligencia artificial para diseñar prendas personalizadas al instante. Describe lo que deseas y la IA generará una visualización de tu prenda ideal.</p>
			<br>
			<br>

			<mat-form-field class="full-width" *ngIf="edicion">
				<mat-label>Id</mat-label>
				<input matInput formControlName="idDiseno" />
			</mat-form-field>
			<br *ngIf="edicion">
			<br *ngIf="edicion">
			
			<mat-form-field class="full-width" *ngIf="edicion">
				<mat-label>Imagen (URL)</mat-label>
				<input matInput formControlName="imagenDiseno" />
			</mat-form-field>
			<br *ngIf="edicion">
			<br *ngIf="edicion">

			<mat-form-field class="full-width">
				<mat-label>Asigna un precio al diseño</mat-label>
				<input matInput type="number" formControlName="precioDiseno" />
			</mat-form-field>
			
			<br *ngIf="edicion">
			<br *ngIf="edicion">
			<mat-form-field class="full-width" *ngIf="edicion">
				<mat-label>Fecha de Origen</mat-label>
				<input matInput [matDatepicker]="picker" formControlName="fechaOrigenDiseno" />
				<mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
				<mat-datepicker #picker></mat-datepicker>
			</mat-form-field>
			
			<br>
			<br>
			<div *ngIf="!form.get('tipoIA')?.value">
  				<mat-form-field class="full-width">
    				<mat-label>Imagen (URL o subida)</mat-label>
    				<input matInput formControlName="imagenDiseno" />
  				</mat-form-field>

  				<!-- Selector de archivo -->
  				<input type="file" accept="image/*" (change)="onFileSelected($event)" />
			</div>
			<!-- Solo aparece si usa IA -->
			<div *ngIf="form.get('tipoIA')?.value" class="prompt-section">
				<mat-form-field class="full-width">
					<mat-label>Describe tu diseño ideal</mat-label>
					<input matInput formControlName="promtDiseno" />
				</mat-form-field>
				<button mat-icon-button color="primary" (click)="generarImagen()" type="button">
					<mat-icon>autorenew</mat-icon>
				</button>
			</div>
			<br>
			<br>
			<!-- Selects para categoría, género y producto -->
			<mat-form-field class="full-width">
				<mat-label>Categoría</mat-label>
				<mat-select formControlName="categoria">
					<mat-option *ngFor="let categoria of categorias" [value]="categoria">{{ categoria.nombreCategoria }}</mat-option>
				</mat-select>
			</mat-form-field>
			<br>
			<br>
			<mat-form-field class="full-width">
				<mat-label>Género</mat-label>
				<mat-select formControlName="genero">
					<mat-option *ngFor="let genero of generos" [value]="genero">{{ genero.nombreGenero }}</mat-option>
				</mat-select>
			</mat-form-field>
			<br>
			<br>
			<mat-form-field class="full-width">
				<mat-label>Producto</mat-label>
				<mat-select formControlName="producto">
					<mat-option *ngFor="let producto of productos" [value]="producto">{{ producto.nombreProducto }}</mat-option>
				</mat-select>
			</mat-form-field>
			<br>
			<br>
			<button mat-raised-button color="primary" type="submit">Guardar Diseño</button>
		</form>

		<!-- Imagen generada a la derecha -->
		<div class="imagen-preview" *ngIf="imagenGenerada">
			<img [src]="imagenGenerada" alt="Diseño generado por IA" />
		</div>
		<div class="tips" *ngIf="form.get('tipoIA')?.value">
			<h3>Consejos para mejores resultados:</h3>
			<ul>
			<li>Sé específico sobre el tipo de prenda (camiseta, vestido, etc.)</li>
			<li>Describe colores, patrones y estilos con detalle</li>
			<li>Menciona el estilo que buscas (casual, formal, vintage)</li>
			<li>Indica si deseas algún texto o logo específico</li>
			</ul>
		</div>
	</div>
</div>